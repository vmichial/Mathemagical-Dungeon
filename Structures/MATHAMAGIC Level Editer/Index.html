<!DOCTYPE html>
<html>

<head>
<title>Testbed</title>
</head>

<body>
<canvas id="GameScreen" width="1200" height="500" style="border:1px solid #c3c3c3;"></canvas>
<textarea id="TextBox" rows="20" cols="100"></textarea>

<script>
var canvas = document.getElementById("GameScreen");
var ctx = canvas.getContext("2d");
var txtb = document.getElementById("TextBox")
canvas.addEventListener('mousemove', getMousePos, false);
canvas.addEventListener('mousedown', onClick, false);

var LeftArrow = new Image();
LeftArrow.src = "LeftArrow.png";
var RightArrow = new Image();
RightArrow.src = "RightArrow.png";
var MapButton = new Image();
MapButton.src = "map_button.png";
var ExportButton = new Image()
ExportButton.src = "export_button.png";


//Variables to set the size of the map grid
var _gridSizeX = 16;
var _gridSizeY = 10;

//The very map you'll be editing
var MapGrid;
var ObGrid;

//Variables to remember the square selected
var _selectSquareX = 0;
var _selectSquareY = 0;

//Variables to remember the square Highlighted
var _highlightSquareX = 0;
var _highlightSquareY = 0;

//Menu variables
var _menuSetX = 5;
var _menuSetY = 5; 
var _menuSetZ = 0;


function onClick(e)
{
		//For selecting a square
		//Make sure that it's on a region that has an actual tile
	if (e.layerX > 0 && e.layerX < _gridSizeX * 50 && e.layerY > 0 && e.layerY < _gridSizeY * 50)
	{
		SelectTile(Math.floor(e.layerX / 50), Math.floor(e.layerY / 50));
	}
	
		//For the Create Map Button: 1000, 20
	if (e.layerX > 1000 && e.layerX < 1080 && e.layerY > 20 && e.layerY < 60)
	{
		_gridSizeX = _menuSetX;
		_gridSizeY = _menuSetY;
		MakeMapAndObjectGrid();
		SelectTile(0, 0);
		_menuSetZ = 0;
	}
	
		//For the grid x slider: _menuSetX
	//Left 840, 20
	if (e.layerX > 840 && e.layerX < 870 && e.layerY > 20 && e.layerY < 50)
	{
		if (1 < _menuSetX) _menuSetX -= 1;
	}
	
	//Right 910, 20
	if (e.layerX > 910 && e.layerX < 940 && e.layerY > 20 && e.layerY < 50)
	{
		if(16 > _menuSetX) _menuSetX += 1;
	}
		
		//For the grid y slider: _menuSetY
	//Left 840, 60
	if (e.layerX > 840 && e.layerX < 870 && e.layerY > 60 && e.layerY < 90)
	{
		if (1 < _menuSetY) _menuSetY -= 1;
	}
	
	//Right 910, 60
	if (e.layerX > 910 && e.layerX < 940 && e.layerY > 60 && e.layerY < 90)
	{
		if (10 > _menuSetY) _menuSetY += 1;
	}
	
	
	
		//For the tile type setter
	//Left 840, 150
	if (e.layerX > 840 && e.layerX < 870 && e.layerY > 150 && e.layerY < 180)
	{
		if (0 < MapGrid[_selectSquareX][_selectSquareY][_menuSetZ]) MapGrid[_selectSquareX][_selectSquareY][_menuSetZ] -= 1;
	}
	
	//Right 910, 150
	if (e.layerX > 910 && e.layerX < 940 && e.layerY > 150 && e.layerY < 180)
	{
		MapGrid[_selectSquareX][_selectSquareY][_menuSetZ] += 1;
	}
	
	
	
		//For the z setter
	//Left 840, 200: _menuSetZ
	if (e.layerX > 840 && e.layerX < 870 && e.layerY > 200 && e.layerY < 230)
	{
		if (0 < _menuSetZ) _menuSetZ -= 1;
	}
	
	//Right 910, 200: _menuSetZ
	if (e.layerX > 910 && e.layerX < 940 && e.layerY > 200 && e.layerY < 230)
	{
		if (2 > _menuSetZ) _menuSetZ += 1;
	}



		//For the Object setter
	//Left 840, 250
	if (e.layerX > 840 && e.layerX < 870 && e.layerY > 250 && e.layerY < 280)
	{
		if (0 < ObGrid[ _selectSquareX][ _selectSquareY][_menuSetZ]) ObGrid[ _selectSquareX][ _selectSquareY][_menuSetZ] -= 1;
	}
	
	//Right 910, 250
	if (e.layerX > 910 && e.layerX < 940 && e.layerY > 250 && e.layerY < 280)
	{
		ObGrid[ _selectSquareX][ _selectSquareY][_menuSetZ] += 1;
	}


		//For the Export Button: 900, 400
	if (e.layerX > 900 && e.layerX < 980 && e.layerY > 400 && e.layerY < 440)
	{
		//console.log("NO!");
		ExportAsText();
	}
	
	//For the Import button: 950, 400
	if (e.layerX > 950 && e.layerX < 1300 && e.layerY > 400 && e.layerY < 440)
	{
		//console.log("NO!");
		ImportFromText();
	}

}

function getMousePos(e)
{
	if (e.layerX > 0 && e.layerX < _gridSizeX * 50 && e.layerY > 0 && e.layerY < _gridSizeY * 50)
	{
		_highlightSquareX = Math.floor(e.layerX / 50);
		_highlightSquareY = Math.floor(e.layerY / 50);
		//console.log(_highlightSquareX, _highlightSquareY);
	}
}


function ExportAsText()
{
	txtb.value = ("" + _gridSizeX + ":" + _gridSizeY +"\n");
	for (var j = 0; j < _gridSizeY; j++)
	{
		for (var i = 0; i < _gridSizeX; i++)
		{
			txtb.value += (MapGrid[i][j] + "p");
		}
		txtb.value += "\n";
	}
	txtb.value += ">>>\n";
	
	for (var j = 0; j < _gridSizeY; j++)
	{
		for (var i = 0; i < _gridSizeX; i++)
		{
			txtb.value += (ObGrid[i][j] + "p");
		}
		txtb.value += "\n";
	}
	txtb.value += "END";
}

function ExportAsCode()
{
	txtb.value = "MapGrid = new Array()\n"
	for (var i = 0; i < _gridSizeX; i++)
	{
		for (var j = 0; j < _gridSizeY; j++)
		{
			txtb.value += ("MapGrid[" + i + "][" + j + "] = new Array(" + MapGrid[i][j] + ");\n");
		}
	}
	txtb.value += "ObGrid = new Array()\n";
	
	for (var j = 0; j < _gridSizeY; j++)
	{
		for (var i = 0; i < _gridSizeX; i++)
		{
			txtb.value += ("ObGrid[" + i + "][" + j + "] = new Array(" + ObGrid[i][j] + ");\n");
		}
	}	
}

function ImportFromText()
{
	var data = txtb.value
	
	var sizeData=data.slice(0, data.search("\n"));
	sizeX = sizeData.slice(0, sizeData.search(":"));
	sizeX = parseInt(sizeX);
	sizeY = sizeData.substr(sizeData.search(":" + 1));
	sizeY = parseInt(sizeY);
	
	_gridSizeX = sizeX;
	_gridSizeY = sizeY;
	
	MapGrid = new Array();
	for (var i = 0; i < sizeX; i++)
	{
		MapGrid[i] = new Array();
	}
	
	data = data.substr(data.search("\n") + 1);
	for (var j = 0; j < sizeY; j++)
	{
		dataRow = data.slice(0, data.search("\n"));
		//console.log(dataRow)
		for (var i = 0; i < sizeX; i++)
		{
			var dataTile = dataRow.slice(0, data.search("p"));
			dataRow = dataRow.substr(data.search("p") + 1);
			
			//console.log("B - ", dataTile)
			
			var bot = dataTile.slice(0, data.search(","));
			
			dataTile = dataTile.substr(data.search(",") + 1);
			
			var mid = dataTile.slice(0, data.search(","));
			
			dataTile = dataTile.substr(data.search(",") + 1);
			
			var top  = dataTile
			
			//console.log("A - ", bot, ":", mid, ":", top);
			
			bot = parseInt(bot)
			mid = parseInt(mid)
			top = parseInt(top)
			
			MapGrid[i][j] = new Array(bot, mid, top);
		}
		
		data = data.substr(data.search("\n") + 1);	
	}
	
	data = data.substr(data.search("\n") + 1);
	
	ObGrid = new Array();
	for (var i = 0; i < sizeX; i++)
	{
		ObGrid[i] = new Array();
	}
	for (var j = 0; j < sizeY; j++)
	{
		dataRow = data.slice(0, data.search("\n"));
		for (var i = 0; i < sizeX; i++)
		{
			var dataTile = dataRow.slice(0, data.search("p"));
			dataRow = dataRow.substr(data.search("p") + 1);
			
			//console.log("B - ", dataTile)
			
			var bot = dataTile.slice(0, data.search(","));
			
			dataTile = dataTile.substr(data.search(",") + 1);
			
			var mid = dataTile.slice(0, data.search(","));
			
			dataTile = dataTile.substr(data.search(",") + 1);
			
			var top  = dataTile
			
			//console.log("A - ", bot, ":", mid, ":", top);
			
			bot = parseInt(bot)
			mid = parseInt(mid)
			top = parseInt(top)
			
			ObGrid[i][j] = new Array(bot, mid, top);
		}
		
		data = data.substr(data.search("\n") + 1);	
	}
	
}

function MakeMapGrid()
{
	MapGrid = new Array();
	for (var i = 0; i < _gridSizeX; i++)
	{
		MapGrid[i] = new Array()
		for(var j = 0; j < _gridSizeY; j++)
		{
			MapGrid[i][j] = new Array();
			MapGrid[i][j][0] = 0;
			MapGrid[i][j][1] = 0;
			MapGrid[i][j][2] = 0;
		}
	}
}

function MakeObjectGrid()
{
	ObGrid = new Array();
	for (var i = 0; i < _gridSizeX; i++)
	{
		ObGrid[i] = new Array()
		for(var j = 0; j < _gridSizeY; j++)
		{
			ObGrid[i][j] = new Array(0, 0, 0);
		}
	}
}

function MakeMapAndObjectGrid()
{
	MakeMapGrid();
	MakeObjectGrid();
}


function DrawMapGrid()
{
	for(var i = 0; i < _gridSizeX; i++)
	{
		for(var j = 0; j < _gridSizeY; j++)
		{
			var tile = MapGrid[i][j][_menuSetZ]
			ctx.fillStyle = "#FFFFFF"
			if(1 == tile) ctx.fillStyle = "#FF0000";
			if(2 == tile) ctx.fillStyle = "#F0F000";
			if(3 == tile) ctx.fillStyle = "#00FF00";
			if(4 == tile) ctx.fillStyle = "#FF00FF";
			if(5 == tile) ctx.fillStyle = "#0000FF";
			
			ctx.fillRect(i * 50, j * 50, 50, 50);
		}
	}
	
	ctx.fillStyle = "#000000";
	for(var i = 0; i <= _gridSizeX * 50; i += 50)
		ctx.fillRect(i, 0, 1, _gridSizeY * 50);
	
	
	for(var i = 0; i <= _gridSizeY * 50; i += 50)
		ctx.fillRect(0, i, _gridSizeX * 50, 1);

}

function DrawObjectGrid()
{
	for (var i = 0; i < _gridSizeX; i++)
	{
		for(var j = 0; j < _gridSizeY; j++)
		{
			ctx.fillStyle = "#000000";
			ctx.font="25px Arial";
			//console.log(ObGrid[i][j]);
			ctx.fillText(ObGrid[i][j][_menuSetZ], i * 50, j * 50 + 50);
		}
	}	
}

function DrawMenu()
{
	ctx.fillStyle = "#888888";
	ctx.fillRect(800, 0, 400, 500)
	
	ctx.fillStyle = "#000000";
	ctx.font="25px Arial";
	
	//Draw the parts for setting the x grid: _menuSetX
	ctx.fillText("X", 810, 40);
	ctx.fillText(_menuSetX, 872, 45);
	ctx.drawImage(LeftArrow, 840, 20);
	ctx.drawImage(RightArrow, 910, 20);
	
	//Draw the parts for setting the y grid: _menuSetY
	ctx.fillText("Y", 810, 80);
	ctx.fillText(_menuSetY, 872, 85);
	ctx.drawImage(LeftArrow, 840, 60);
	ctx.drawImage(RightArrow, 910, 60);
	
	//Draw the grid setter button
	ctx.drawImage(MapButton, 1000, 20)
	
	
	//Draw the parts for setting the type setter
	ctx.fillText("S", 810, 170);
	ctx.fillText(MapGrid[ _selectSquareX][ _selectSquareY][_menuSetZ], 872, 175);
	ctx.drawImage(LeftArrow, 840, 150);
	ctx.drawImage(RightArrow, 910, 150);
	
	//Draw the parts for setting the z axis
	ctx.fillText("Z", 810, 220);
	ctx.fillText(_menuSetZ, 872, 225);
	ctx.drawImage(LeftArrow, 840, 200);
	ctx.drawImage(RightArrow, 910, 200);
	
	//Draw the parts for the object setter
	ctx.fillText("Ob", 807, 270);
	ctx.fillText(ObGrid[ _selectSquareX][ _selectSquareY][_menuSetZ], 872, 275);
	ctx.drawImage(LeftArrow, 840, 250);
	ctx.drawImage(RightArrow, 910, 250);
	
	//Draw the export button
	ctx.drawImage(ExportButton, 900, 400);
	
}

function SelectTile(x, y)
{
	_selectSquareX = x;
	_selectSquareY = y;
}

setInterval(Game, 1000/60);

MakeMapAndObjectGrid()
function Game()
{
	ctx.fillStyle = "#000000";
	ctx.fillRect(0, 0, 1200, 500);
	
	
	DrawMapGrid();
	DrawObjectGrid();
	DrawMenu();
	
	
	//ctx.fillStyle = "#00FF00";
	ctx.strokeRect(_highlightSquareX * 50, _highlightSquareY * 50, 40, 40)

	//ctx.fillStyle = "#00FFFF";
	ctx.strokeRect(_selectSquareX * 50, _selectSquareY * 50, 50, 50)
	
	//test.Draw();	
}


</script>




</body>

</html>